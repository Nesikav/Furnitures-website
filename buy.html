<!-- buy.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Buy Now</title>
</head>
<body>
  <h1 style="text-align:center;">Buy Now - Address Form</h1>

  <form id="checkout-form" style="max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 10px;">
    <label>Full Name:</label><br>
    <input type="text" id="name" required style="width: 100%; margin-bottom: 10px;"><br>

    <label>Email:</label><br>
    <input type="email" id="email" required style="width: 100%; margin-bottom: 10px;"><br>

    <label>Phone:</label><br>
    <input type="tel" id="phone" required style="width: 100%; margin-bottom: 10px;"><br>

    <label>Address:</label><br>
    <textarea id="address" required style="width: 100%; height: 100px; margin-bottom: 10px;"></textarea><br>

    <button type="submit">Confirm Purchase</button>
  </form>

  <script>
    document.getElementById("checkout-form").addEventListener("submit", function(event) {
      event.preventDefault(); // prevent form submit

      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;
      const phone = document.getElementById("phone").value;
      const address = document.getElementById("address").value;

      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      let orderDetails = "";
      let total = 0;

      cart.forEach(item => {
        const price = Number(item.price); // ✅ Correct conversion
        orderDetails += `\nProduct: ${item.name}\nPrice: ₹${price}\nDescription: ${item.description}\n\n`;
        total += price;
      });

      orderDetails += `Total Price: ₹${total.toFixed(2)}`;

      // Send email
      fetch("http://localhost:3000/send-email", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          name: name,
          email: email,
          orderDetails: orderDetails
        })
      })
      .then(response => response.text())
      .then(data => {
        alert("Thank you for your purchase! Email Sent.");
        localStorage.removeItem("cart"); // Clear cart after purchase
        window.location.href = "index.html"; // Redirect after successful order
      })
      .catch(error => {
        console.error("Error:", error);
        alert("Something went wrong. Please try again.");
      });
    });
  </script>

  <div style="text-align: center; margin: 30px;">
    <a href="product.html">
      <button style="background-color: #444; color: white; padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer;">
        ← Back to Home
      </button>
    </a>
  </div>
</body>
</html>
